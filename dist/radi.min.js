!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd||e(t.radi={})}(this,function(t){"use strict";var e=/((\/\/.*$)|(\/\*[\s\S]*?\*\/))/gm,n=/\bl\(/g,r="(".charCodeAt(0),i=")".charCodeAt(0),o="#".charCodeAt(0),s=".".charCodeAt(0),a=!1;function c(t){var e,n;if("object"==typeof t){if(null===t)return t;if("[object Array]"===Object.prototype.toString.call(t)){var r=t.length;for(n=new Array(r),e=0;e<r;e++)"object"==typeof t[e]?n[e]=c(t[e]):n[e]=t[e]}else for(e in n={},t)t.hasOwnProperty(e)&&(t[e],n[e]=c(t[e]))}else n=t;return n}var l=function(t,e){var n=function(t){for(var e=null,n=null,r=null,i=0,a="",c=0;c<=t.length;c++){var l=t.charCodeAt(c),u=l===o,f=l===s;u||f||!l?(0===i?e=0===c?"div":a:1===i?n=a:r?r+=" "+a:r=a,u?i=1:f&&(i=2),a=""):a+=t[c]}return{tag:e,id:n,className:r}}(t),r=n.tag,i=n.id,a=n.className,c=e?document.createElementNS(e,r):document.createElement(r);return i&&(c.id=i),a&&(e?c.setAttribute("class",a):c.className=a),c};Array.isArray||(Array.isArray=function(t){return"[object Array]"===Object.prototype.toString.call(t)});var u=function(t,e){Object.defineProperties(t,{reverse:{value:e.bind("reverse")},push:{value:e.bind("push")},splice:{value:e.bind("splice")},pop:{value:e.bind("pop")},shift:{value:e.bind("shift")}})},f=0;const p=[];var h=function t(e){if("function"==typeof e.unmount&&e.unmount(),e.children&&e.children.length>0)for(var n=0;n<e.children.length;n++)t(e.children[n])},d=function t(e){if("function"==typeof e.mount&&e.mount(),e.children&&e.children.length>0)for(var n=0;n<e.children.length;n++)t(e.children[n])},v=function(t,e,n){var r=this,i=y(t);if(w(n)){var o=n.get();i.style[e]=o,function(t,e,n){r.$e.on(n.path,function(e,n){if(n===t)return!1;t=n})}(o,0,n)}else if(void 0!==n)i.style[e]=n;else if(m(e))i.setAttribute("style",e);else for(var s in e)v.call(this,i,s,e[s])},g=function(t,e,n){var r=this,i=y(t);if(void 0!==n)if("style"===e)v.call(this,i,n);else if("model"===e&&w(n)){var o=n.get();i.value=o,i.oninput=function(){n.source[n.prop]=o=i.value,r.$e.emit(n.path,i.value)},function(t,e,n){r.$e.on(n.path,function(e,n){if(n===t)return!1;t=n})}(o,0,n)}else if($(n))i[e]=function(t){n.call(r,t)};else if(w(n)){var s=n.get();if($(s))i[e]=function(t){n.get().call(r,t)};else{o=n.get();i.setAttribute(e,o);!function(t,e,n){r.$e.on(n.path,function(e,n){if(n===t)return!1;t=n})}(o,0,n)}}else i.setAttribute(e,n);else for(var a in e)g.call(this,i,a,e[a])},y=function(t){return t.nodeType&&t||!t.el&&t||y(t.el)},m=function(t){return"string"==typeof t},b=function(t){return"number"==typeof t},$=function(t){return"function"==typeof t},_=function(t){return t&&t.nodeType},w=function(t){return t&&t instanceof T},A=function(t){return t&&t instanceof P},C=function(t){return t&&t.__radi};const j=function(t){return document.createTextNode(t)};var N=function(t,e){for(var n=this,r=0;r<e.length;r++){var i=e[r];if(0===i||i)if(C(i))t.appendChild(i.__radi().$render());else if(A(i)){var o,s=i.__do(),a=s.id;o=C(s.r)?s.r.__radi().$render():"function"==typeof s.r?s.r():m(s.r)||b(s.r)?j(s.r):s.r,t.appendChild(o),function(t){t.watch(function(e){var n,r=t.__do();if(a===r.id)return!1;n=C(r.r)?r.r.__radi().$render():"function"==typeof r.r?r.r():m(r.r)||b(r.r)?j(r.r):r.r,h(o),o.parentNode.replaceChild(n,o),d(o=n),a=r.id})}(i)}else if("function"==typeof i)i.call(this,t);else if(m(i)||b(i))t.appendChild(j(i));else if(_(y(i)))t.appendChild(i);else if(Array.isArray(i))N.call(this,t,i);else if(w(i)){var c=i.get();let e=j(c);t.appendChild(e),function(t,e){n.$e.on(e.path,function(e,n){if(n===t)return!1;t=n})}(c,i)}else"object"==typeof i&&g.call(this,t,i)}},x={},S=function(t){return x[t]||(x[t]=l(t))};const k=function(t){for(var e,n=[],r=arguments.length-1;r-- >0;)n[r]=arguments[r+1];return e=m(t)?S(t).cloneNode(!1):_(t)?t.cloneNode(!1):document.createDocumentFragment(),N.call(this,e,n),e};k.extend=function(t){for(var e=[],n=arguments.length-1;n-- >0;)e[n]=arguments[n+1];var r=S(t);return k.bind.apply(k,[this,r].concat(e))};var E=function(t){this.o={name:t.name,state:c(t.state),props:c(t.props),actions:t.actions,view:t.view,$view:t.$view},this.__radi=function(){return new function(t){var e={},n=function t(n,i){if("object"!=typeof n||!n||/^this\.\$(?:view|props|actions|state|link|e|html)$/.test(i))return!1;var o=void 0===n.__path&&Object.defineProperty(n,"__path",{value:i});for(var s in n)Object.getOwnPropertyDescriptor(n,s).set||("object"==typeof n[s]&&t(n[s],i+"."+s),r(n,s),e.$e.emit(i+"."+s,n[s]));return o},r=function(t,r,i){var o=t[r],s=t.__path+"."+r,a=function(t){var r;return o!==t&&(Array.isArray(o)?(this&&this.constructor===String?r=Array.prototype[this].apply(o,arguments):u(o=t,a),n(o,s),e.$e.emit(s,o),r):("object"==typeof t?(o=c(t),n(o,s),e.$e.emit(s,o)):(n(o=t,s),e.$e.emit(s,o)),t))};Array.isArray(o)&&u(o,a),delete t[r]};for(var i in t.state){if(void 0!==e[i])throw new Error("[Radi.js] Err: Trying to write state for reserved variable `"+i+"`");e[i]=t.state[i]}var o=[].slice;for(var i in e.$e={subscriptions:[],on(t,e){var n;return null==this.subscriptions&&(this.subscriptions={}),null==(n=this.subscriptions)[t]&&(n[t]=[]),this.subscriptions[t].push(e),this},listeners(t){var e,n,r,i;for(n in null==this.subscriptions&&(this.subscriptions={}),e=this.subscriptions[t]||[],i=this.regexpSubscriptions)(r=i[n]).regexp.test(t)&&(e=e.concat(r.callbacks));return e},emit(){var t,e,n,r,i,s;for(n=arguments[0],t=2<=arguments.length?o.call(arguments,1):[],r=0,i=(s=this.listeners(n)).length;r<i;r++)(e=s[r]).call.apply(e,[this,n].concat(o.call(t)));return this},off(t,e){var n,r,i,o,s;if(null==t)this.subscriptions={},this.regexpSubscriptions={};else if(null==e)null!=(s=this.subscriptions)&&delete s[t];else for(r=i=0,o=(n=this.subscriptions[t]||[]).length;i<o;r=++i)n[r]===e&&n.splice(r,1);return this}},n(e,"this"),t.actions){if(void 0!==e[i])throw new Error("[Radi.js] Error: Trying to write action for reserved variable `"+i+"`");e[i]=function(){return a?null:this.apply(e,arguments)}.bind(t.actions[i])}return e.$id=f++,e.$name=t.name,e.$state=t.state||{},e.$props=t.props||{},e.$actions=t.actions||{},e.$html=document.createDocumentFragment(),e.$view=new Function("r","list","ll","cond","return "+t.$view)(k.bind(e),M.bind(e),z.bind(e),F.bind(e)),e.$link=e.$view(),e.$html.appendChild(e.$link),e.$render=function(){return e.mount(),e.$html},e.mount=function(){console.log("MOUNT",e.$name),"function"==typeof e.$actions.onMount&&e.$actions.onMount.call(e),p.push(e)},e.unmount=function(){console.log("UNMOUNT",e.$name),"function"==typeof e.$actions.onDestroy&&e.$actions.onDestroy.call(e);for(var t=0;t<p.length;t++)if(p[t].$id===e.$id){p.splice(t,1);break}return e.$link},e.$link.unmount=e.unmount.bind(e),e.$link.mount=e.mount.bind(e),e}(this.o)}};E.prototype.props=function(t){for(var e in t)void 0===this.o.props[e]&&console.warn("[Radi.js] Warn: Creating a prop `",e,"` that is not defined in component"),this.o.props[e]=t[e];return this};var O=j("");const M=function(t,e){if(!t)return"";var n,r=this,i=document.createDocumentFragment(),o=O.cloneNode();i.appendChild(o);var s,a=t.source[t.prop];if(s=a,!0===Array.isArray(s))for(var c=0;c<a.length;c++)i.appendChild(e.call(r,a[c],c));else{c=0;for(var l in a)i.appendChild(e.call(r,a[l],l,c)),c++}n=i.lastChild;if(t.path){var u=a.length;r.$e.on(t.path,function(o,s){!function(o,s){if(o>0){for(var a=s.length,c=a-o;c<a;c++)i.appendChild(e.call(r,t.source[t.prop][c],c));var l=i.lastChild;n.parentElement.insertBefore(i,n.nextSibling),n=l}else if(o<0)for(c=0;c<Math.abs(o);c++){var u=n.previousSibling;n.parentElement.removeChild(n),n=u}}(s.length-u,s),u=s.length})}return i};function T(t,e,n){this.path=(n||t.__path)+"."+e,this.get=(()=>t[e]),this.source=t,this.prop=e}const D=function(t,e,n){var r={s:null},i=this,o=()=>t.call(this);if(1===n.length&&t.toString().replace(/(function \(\)\{ return |\(|\)|\; \})/g,"").trim()===n[0])return new T(e[0][0],e[0][1]);var s=e.length;r.s=o();for(var a=[],c=0;c<s;c++)a.push(e[c][0].__path+"."+e[c][1]);r.__path="$+"+a.join("+"),console.log("reduce",r.__path);for(c=0;c<s;c++){e[c][0][e[c][1]];!function(t,e,n){i.$e.on(t,t=>{var n=o();e.s=n,i.$e.emit(e.__path,o())})}(e[c][0].__path+"."+e[c][1],r)}return s<=0?r.s:new T(r,"s",r.__path)},F=function(t,e){return new P(t,e,this)};var P=function(t,e,n){this.cases=[{a:t,e:e}],this.w=[],this.els=O.cloneNode(),w(t)&&this.w.push(t),this.watch=function(t){for(var e in this.w)n.$e.on(this.w[e].path,(e,n)=>{t(n)})},this.__do=function(){var t={id:null};for(var e in this.cases){if(w(this.cases[e].a)?this.cases[e].a.get():this.cases[e].a){t.id=e,t.r=this.cases[e].e;break}}return void 0===t.r&&(t.r=this.els),t}};P.prototype.elseif=function(t,e){return this.cases.push({a:t,e:e}),w(t)&&this.w.push(t),this},P.prototype.cond=P.prototype.elseif,P.prototype.else=function(t){return this.els=t,this};const z=function(t,e,n){return e?D.call(this,t,e,n.split(",")):t};t.version="0.1.0",t.activeComponents=p,t.text=j,t.r=k,t.component=function(t){for(var o=t.view.toString().replace(e,""),s=n.exec(o),a=[],c=0;null!==s;){var l=s.index,u=s.input,f=1,p=0;const t=u.length;for(var h=l+2;h<t;h++){var d=u.charCodeAt(h);if(d===r?f+=1:d===i&&(p+=1),f===p)break}var v=u.substr(l,h+1-l),g=v.match(/[a-zA-Z_$]+(?:\.\w+(?:\[.*\])?)+/g)||[],y=[];for(h=0;h<g.length;h++){var m=g[h].split(".");if(m.length>1){var b=m.splice(-1)[0];y.push("["+m+', "'+b+'"]')}}y=y.join(",");var $="ll(function(){ return "+v.substr(1)+"; },["+y+'], "'+g.join(",")+'")';a.push(o.substr(c,l-c)),a.push($),c=l+v.length,s=n.exec(o)}return a.push(o.substr(c,o.length-c)),t.$view=a.join(""),E.bind(this,t)},t.mount=function(t,e){const n=e.constructor===String?document.getElementById(e):e;var r=t instanceof E?t.__radi().$render():t;return n.appendChild(r),r},t.list=M,t.link=D,t.cond=F,t.l=function(t){return t},t.ll=z,t.freeze=(()=>{a=!0}),t.unfreeze=(()=>{a=!1;for(var t=0;t<p.length;t++)"function"==typeof p[t].onMount&&p[t].onMount.call(p[t])})});
//# sourceMappingURL=radi.js.map