!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports):"function"==typeof define&&define.amd||n(e.radi={})}(this,function(e){"use strict";var n=/((\/\/.*$)|(\/\*[\s\S]*?\*\/))/gm,t=/\bl\(/g,r="(".charCodeAt(0),i=")".charCodeAt(0),o="#".charCodeAt(0),a=".".charCodeAt(0),u=0,s=1,l=2,c=!1,f={};function p(e){return!0===Array.isArray(e)}function h(e){var n,t;if("object"==typeof e){if(null===e)return e;if("[object Array]"===Object.prototype.toString.call(e)){var r=e.length;for(t=new Array(r),n=0;n<r;n++)"object"==typeof e[n]?t[n]=h(e[n]):t[n]=e[n]}else for(n in t={},e)e.hasOwnProperty(n)&&(e[n],t[n]=h(e[n]))}else t=e;return t}function d(e,n){var t=function(e){for(var n=null,t=null,r=null,i=u,c="",f=0;f<=e.length;f++){var p=e.charCodeAt(f),h=p===o,d=p===a;h||d||!p?(i===u?n=0===f?"div":c:i===s?t=c:r?r+=" "+c:r=c,h?i=s:d&&(i=l),c=""):c+=e[f]}return{tag:n,id:t,className:r}}(e),r=t.tag,i=t.id,c=t.className,f=n?document.createElementNS(n,r):document.createElement(r);return i&&(f.id=i),c&&(n?f.setAttribute("class",c):f.className=c),f}Array.isArray||(Array.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)});var v=function(e,n){return!(!p(e)||e.__radi)&&Object.defineProperties(e,{__radi:{value:!0},reverse:{value:n.bind("reverse")},push:{value:n.bind("push")},splice:{value:n.bind("splice")},pop:{value:n.bind("pop")},shift:{value:n.bind("shift")}})},m=0;const y=[];function g(e){if("function"==typeof e.unmount&&e.unmount(),e.children&&e.children.length>0)for(var n=0;n<e.children.length;n++)g(e.children[n])}function $(e){if("function"==typeof e.mount&&e.mount(),e.children&&e.children.length>0)for(var n=0;n<e.children.length;n++)$(e.children[n])}function b(e,n,t){var r=this,i=w(e);if(void 0!==t)if("style"===n)(function e(n,t,r){var i=this,o=w(n);if(N(r)){var a=r.get();o.style[t]=a,function(e,n,t){i.$e.on(t.path,function(n,t){if(t===e)return!1;e=t})}(a,0,r)}else if(void 0!==r)o.style[t]=r;else if(_(t))o.setAttribute("style",t);else for(var u in t)e.call(this,o,u,t[u])}).call(this,i,t);else if("model"===n&&N(t)){var o=t.get();i.value=o,i.oninput=function(){t.source[t.prop]=o=i.value,r.$e.emit(t.path,i.value)},function(e,n,t){r.$e.on(t.path,function(n,t){if(t===e)return!1;e=t})}(o,0,t)}else if(C(t))i[n]=function(e){t.call(r,e)};else if(N(t)){var a=t.get();if(C(a))i[n]=function(e){t.get().call(r,e)};else!1!==(o=t.get())&&("html"===n?i.innerHTML=o:i.setAttribute(n,o)),function(e,n,t){r.$e.on(t.path,function(n,t){if(t===e)return!1;e=t})}(o,0,t)}else!1!==o&&("html"===n?i.innerHTML=t:i.setAttribute(n,t));else for(var u in n)b.call(this,i,u,n[u])}var w=function(e){return e.nodeType&&e||!e.el&&e||w(e.el)},_=function(e){return"string"==typeof e},A=function(e){return"number"==typeof e},C=function(e){return"function"==typeof e},j=function(e){return e&&e.nodeType},N=function(e){return e&&e instanceof z},E=function(e){return e&&e instanceof L},k=function(e){return e&&e.__radi};const O=function(e){return document.createTextNode(e)};var S={};function T(e){return S[e]||(S[e]=d(e))}function x(e){for(var n,t=[],r=arguments.length-1;r-- >0;)t[r]=arguments[r+1];if(_(e)){if(void 0!==f[e]){var i=t[0]||{};return(new f[e]).props(i)}n=T(e).cloneNode(!1)}else n=j(e)?e.cloneNode(!1):document.createDocumentFragment();return function e(n,t){for(var r=this,i=0;i<t.length;i++){var o=t[i];if(0===o||o)if(k(o))n.appendChild(o.__radi().$render());else if(E(o)){var a,u=o.__do(),s=u.id;a=k(u.r)?u.r.__radi().$render():"function"==typeof u.r?u.r():_(u.r)||A(u.r)?O(u.r):u.r,n.appendChild(a),function(e){e.watch(function(n){var t,r=e.__do();if(s===r.id)return!1;t=k(r.r)?r.r.__radi().$render():"function"==typeof r.r?r.r():_(r.r)||A(r.r)?O(r.r):r.r,g(a),a.parentNode.replaceChild(t,a),$(a=t),s=r.id})}(o)}else if("function"==typeof o)o.call(this,n);else if(_(o)||A(o))n.appendChild(O(o));else if(j(w(o)))n.appendChild(o);else if(Array.isArray(o))e.call(this,n,o);else if(N(o)){var l=o.get();let e=O(l);n.appendChild(e),function(e,n){r.$e.on(n.path,function(n,t){if(t===e)return!1;e=t})}(l,o)}else"object"==typeof o&&b.call(this,n,o)}}.call(this,n,t),n}function P(e){var o=e.view.toString().replace(n,""),a=t.exec(o),u=0;for(e.$view="";null!==a;){var s=a.index,l=a.input,c=1,f=0;const n=l.length;for(var p=s+2;p<n;p++){var h=l.charCodeAt(p);if(h===r?c+=1:h===i&&(f+=1),c===f)break}var d=l.substr(s,p+1-s),v=d.match(/[a-zA-Z_$]+(?:\.\w+(?:\[.*\])?)+/g)||[],m=[];for(p=0;p<v.length;p++){var y=v[p].split(".");if(y.length>1){var g=y.splice(-1)[0];m.push("["+y.join(".")+', "'+g+'"]')}}m=m.join(",");var $="ll(function(){ return "+d.substr(1)+"; },["+m+'], "'+v.join(",")+'")';e.$view=e.$view.concat(o.substr(u,s-u)).concat($),u=s+d.length,a=t.exec(o)}return e.$view=e.$view.concat(o.substr(u,o.length-u)),M.bind(this,e)}function M(e){this.o={name:e.name,state:h(e.state),props:h(e.props),actions:e.actions,view:e.view,$view:e.$view},this.__radi=function(){return new function(e){var n={__path:"this"};function t(e,i){var o;if("object"!=typeof e||!e)return!1;for(var a in o=void 0===e.__path&&Object.defineProperty(e,"__path",{value:i}),e)e.hasOwnProperty(a)&&!Object.getOwnPropertyDescriptor(e,a).set&&("object"==typeof e[a]&&t(e[a],i+"."+a),r(e,a,i.concat(".").concat(a)),n.$e.emit(i+"."+a,e[a]));return o}function r(e,r,i){var o=e[r],a=function(e){var r;return o!==e&&(Array.isArray(o)?(this&&this.constructor===String?r=Array.prototype[this].apply(o,arguments):v(o=e,a),t(o,i),n.$e.emit(i,o),r):("object"==typeof e?(t(o=h(e),i),n.$e.emit(i,o)):(t(o=e,i),n.$e.emit(i,o)),e))};Array.isArray(o)&&v(o,a),delete e[r]}for(var i in Object.defineProperties(n,{$e:{enumerable:!1,value:{WATCH:{},get:e=>n.$e.WATCH[e]||(n.$e.WATCH[e]=[]),on:(e,t)=>c?null:n.$e.get(e).push(t),emit(e,t){if(c)return null;for(var r=n.$e.get(e),i=r.length,o=0;o<i;o++)r[o](e,t)}}}}),e.state){if(void 0!==n[i])throw new Error("[Radi.js] Err: Trying to write state for reserved variable `"+i+"`");n[i]=e.state[i]}for(var i in e.props){if(void 0!==n[i])throw new Error("[Radi.js] Err: Trying to write prop for reserved variable `"+i+"`");N(e.props[i])?(n[i]=e.props[i].get(),e.props[i].parent&&e.props[i].parent().$e.on(e.props[i].path,(e,t)=>{n[i]=t})):n[i]=e.props[i]}for(var i in t(n,"this"),e.actions){if(void 0!==n[i])throw new Error("[Radi.js] Error: Trying to write action for reserved variable `"+i+"`");n[i]=function(){return c?null:e.actions[this].apply(n,arguments)}.bind(i)}return Object.defineProperties(n,{$id:{enumerable:!1,value:m++},$name:{enumerable:!1,value:e.name},$state:{enumerable:!1,value:e.state||{}},$props:{enumerable:!1,value:e.props||{}},$actions:{enumerable:!1,value:e.actions||{}},$html:{enumerable:!1,value:document.createDocumentFragment()},$parent:{enumerable:!1,value:null},$view:{enumerable:!1,value:new Function("r","list","ll","cond","return "+e.$view)(x.bind(n),W.bind(n),Z.bind(n),B.bind(n))},$render:{enumerable:!1,value:function(){return n.mount(),n.$html}}}),Object.defineProperties(n,{$link:{enumerable:!1,value:n.$view()}}),n.$html.appendChild(n.$link),n.$html.destroy=function(){const e=n.$link.parentElement,t=e.cloneNode(!1);e.parentNode.insertBefore(t,e),n.unmount(),e.parentNode.removeChild(e)},n.mount=function(){"function"==typeof n.$actions.onMount&&n.$actions.onMount.call(n),y.push(n)},n.unmount=function(){"function"==typeof n.$actions.onDestroy&&n.$actions.onDestroy.call(n);for(var e=0;e<y.length;e++)if(y[e].$id===n.$id){y.splice(e,1);break}return n.$link},n.$link.unmount=n.unmount.bind(n),n.$link.mount=n.mount.bind(n),n}(this.o)}}x.extend=function(e){for(var n=[],t=arguments.length-1;t-- >0;)n[t]=arguments[t+1];var r=T(e);return x.bind.apply(x,[this,r].concat(n))},M.prototype.props=function(e){for(var n in e)void 0===this.o.props[n]&&console.warn("[Radi.js] Warn: Creating a prop `",n,"` that is not defined in component"),this.o.props[n]=e[n];return this};const R=function(e,n){const t=n.constructor===String?document.getElementById(n):n;var r=e instanceof M?e.__radi().$render():e;return t.appendChild(r),r};var D=O("");const W=function(e,n){if(!e)return"";var t,r=this,i=document.createDocumentFragment(),o=D.cloneNode();i.appendChild(o);var a=e.source[e.prop]||[],u=a.length||0;if(p(a))for(var s=0;s<u;s++)i.appendChild(n.call(r,a[s],s));else{s=0;for(var l in a)i.appendChild(n.call(r,a[l],l,s)),s++}t=i.lastChild;if(a.__path){var c=u;r.$e.on(a.__path,function(e,o){!function(e,o){if(e>0){for(var a=o.length,u=a-e;u<a;u++)i.appendChild(n.call(r,o[u],u));var s=i.lastChild;t.parentElement.insertBefore(i,t.nextSibling),t=s}else if(e<0)for(u=0;u<Math.abs(e);u++){var l=t.previousSibling;t.parentElement.removeChild(t),t=l}}(o.length-c,o),c=o.length})}return i};function z(e,n,t){this.path=e.__path+"."+n,this.get=(()=>e[n]),this.source=e,this.prop=n,this.parent=t}var F=0;const H=function(e,n,t){var r={s:null,a:[],t:[],f:e.toString()},i=this;if(1===t.length&&e.toString().replace(/(function \(\)\{ return |\(|\)|\; \})/g,"").trim()===t[0])return new z(n[0][0],n[0][1],function(){return i});var o=n.length;r.s=e.call(this),r.a=new Array(o),r.t=new Array(o),r.__path="$link-"+F,F+=1;for(var a=0;a<o;a++)r.a[a]=n[a][0][n[a][1]],r.t[a]="$rdi["+a+"]",r.f=r.f.replace(t[a],r.t[a]),function(e,n,t,r){i.$e.on(e,(e,o)=>{n.a[r]=o;var a=n.f.call(i,n.a);n.s!==a&&(n.s=a,i.$e.emit(t,n.s))})}(n[a][0].__path+"."+n[a][1],r,r.__path+".s",a);return r.f=new Function("$rdi","return "+r.f+"();"),o<=0?r.s:new z(r,"s",function(){return i})};function B(e,n){return new L(e,n,this)}function L(e,n,t){this.cases=[{a:e,e:n}],this.w=[],this.cache=[],this.els=D.cloneNode(),N(e)&&this.w.push(e),this.watch=function(e){for(var n in this.w)(function(n){t.$e.on(this.w[n].path,(n,t)=>{e(t)})}).call(this,n)},this.__do=function(){var e={id:null};for(var n in this.cases){if(N(this.cases[n].a)?this.cases[n].a.get():this.cases[n].a){e.id=n,e.r=this.cases[n].e;break}}return void 0===e.r&&(e.r=this.els),e}}function I(e){return e}function Z(e,n,t){return n?H.call(this,e,n,t.split(",")):e}function q(){c=!0}function G(){c=!1;for(var e=0;e<y.length;e++)"function"==typeof y[e].onMount&&y[e].onMount.call(y[e])}L.prototype.elseif=function(e,n){return this.cases.push({a:e,e:n}),N(e)&&this.w.push(e),this},L.prototype.cond=L.prototype.elseif,L.prototype.else=function(e){return this.els=e,this};const J={version:"0.1.3",activeComponents:y,r:x,l:I,cond:B,component:P,mount:R,freeze:q,unfreeze:G};window.$Radi=J,e.version="0.1.3",e.activeComponents=y,e.text=O,e.r=x,e.component=P,e.mount=R,e.list=W,e.link=H,e.cond=B,e.l=I,e.ll=Z,e.freeze=q,e.unfreeze=G,e.use=function(e){return e(J)},e.register=function(e){var n=(new e).o.name;n?void 0!==f[n]?console.warn("[Radi.js] Warn: Component with name '"+n+"' already registered"):f[n]=e:console.warn("[Radi.js] Warn: Cannot register component without name")}});
//# sourceMappingURL=radi.js.map