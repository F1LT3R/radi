!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd||e(t.radi={})}(this,function(t){"use strict";var e=/((\/\/.*$)|(\/\*[\s\S]*?\*\/))/gm,n=/\bl\(/g,r="(".charCodeAt(0),i=")".charCodeAt(0),o="#".charCodeAt(0),a=".".charCodeAt(0),s=!1;function c(t){var e,n;if("object"==typeof t){if(null===t)return t;if("[object Array]"===Object.prototype.toString.call(t)){var r=t.length;for(n=new Array(r),e=0;e<r;e++)"object"==typeof t[e]?n[e]=c(t[e]):n[e]=t[e]}else for(e in n={},t)t.hasOwnProperty(e)&&(t[e],n[e]=c(t[e]))}else n=t;return n}var l=function(t,e){var n=function(t){for(var e=null,n=null,r=null,i=0,s="",c=0;c<=t.length;c++){var l=t.charCodeAt(c),u=l===o,f=l===a;u||f||!l?(0===i?e=0===c?"div":s:1===i?n=s:r?r+=" "+s:r=s,u?i=1:f&&(i=2),s=""):s+=t[c]}return{tag:e,id:n,className:r}}(t),r=n.tag,i=n.id,s=n.className,c=e?document.createElementNS(e,r):document.createElement(r);return i&&(c.id=i),s&&(e?c.setAttribute("class",s):c.className=s),c};Array.isArray||(Array.isArray=function(t){return"[object Array]"===Object.prototype.toString.call(t)});var u=function(t,e){return!t.__radi&&Object.defineProperties(t,{__radi:{value:!0},reverse:{value:e.bind("reverse")},push:{value:e.bind("push")},splice:{value:e.bind("splice")},pop:{value:e.bind("pop")},shift:{value:e.bind("shift")}})},f=0;const p=[];var h=function t(e){if("function"==typeof e.unmount&&e.unmount(),e.children&&e.children.length>0)for(var n=0;n<e.children.length;n++)t(e.children[n])},d=function t(e){if("function"==typeof e.mount&&e.mount(),e.children&&e.children.length>0)for(var n=0;n<e.children.length;n++)t(e.children[n])},v=function(t,e,n){var r=this,i=g(t);if(_(n)){var o=n.get();i.style[e]=o,function(t,e,n){r.$e.on(n.path,function(e,n){if(n===t)return!1;t=n})}(o,0,n)}else if(void 0!==n)i.style[e]=n;else if(m(e))i.setAttribute("style",e);else for(var a in e)v.call(this,i,a,e[a])},y=function(t,e,n){var r=this,i=g(t);if(void 0!==n)if("style"===e)v.call(this,i,n);else if("model"===e&&_(n)){var o=n.get();i.value=o,i.oninput=function(){n.source[n.prop]=o=i.value,r.$e.emit(n.path,i.value)},function(t,e,n){r.$e.on(n.path,function(e,n){if(n===t)return!1;t=n})}(o,0,n)}else if(b(n))i[e]=function(t){n.call(r,t)};else if(_(n)){var a=n.get();if(b(a))i[e]=function(t){n.get().call(r,t)};else{o=n.get();i.setAttribute(e,o);!function(t,e,n){r.$e.on(n.path,function(e,n){if(n===t)return!1;t=n})}(o,0,n)}}else i.setAttribute(e,n);else for(var s in e)y.call(this,i,s,e[s])},g=function(t){return t.nodeType&&t||!t.el&&t||g(t.el)},m=function(t){return"string"==typeof t},$=function(t){return"number"==typeof t},b=function(t){return"function"==typeof t},w=function(t){return t&&t.nodeType},_=function(t){return t&&t instanceof D},A=function(t){return t&&t instanceof R},C=function(t){return t&&t.__radi};const j=function(t){return document.createTextNode(t)};var k=function(t,e){for(var n=this,r=0;r<e.length;r++){var i=e[r];if(0===i||i)if(C(i))t.appendChild(i.__radi().$render());else if(A(i)){var o,a=i.__do(),s=a.id;o=C(a.r)?a.r.__radi().$render():"function"==typeof a.r?a.r():m(a.r)||$(a.r)?j(a.r):a.r,t.appendChild(o),function(t){t.watch(function(e){var n,r=t.__do();if(s===r.id)return!1;n=C(r.r)?r.r.__radi().$render():"function"==typeof r.r?r.r():m(r.r)||$(r.r)?j(r.r):r.r,h(o),o.parentNode.replaceChild(n,o),d(o=n),s=r.id})}(i)}else if("function"==typeof i)i.call(this,t);else if(m(i)||$(i))t.appendChild(j(i));else if(w(g(i)))t.appendChild(i);else if(Array.isArray(i))k.call(this,t,i);else if(_(i)){var c=i.get();let e=j(c);t.appendChild(e),function(t,e){n.$e.on(e.path,function(e,n){if(n===t)return!1;t=n})}(c,i)}else"object"==typeof i&&y.call(this,t,i)}},E={},S=function(t){return E[t]||(E[t]=l(t))};const N=function(t){for(var e,n=[],r=arguments.length-1;r-- >0;)n[r]=arguments[r+1];return e=m(t)?S(t).cloneNode(!1):w(t)?t.cloneNode(!1):document.createDocumentFragment(),k.call(this,e,n),e};N.extend=function(t){for(var e=[],n=arguments.length-1;n-- >0;)e[n]=arguments[n+1];var r=S(t);return N.bind.apply(N,[this,r].concat(e))};var x=function(t){this.o={name:t.name,state:c(t.state),props:c(t.props),actions:t.actions,view:t.view,$view:t.$view},this.__radi=function(){return new function(t){var e={},n=function t(n,i){if("object"!=typeof n||!n||/^this\.\$(?:parent|view|props|actions|state|link|e|html)$/.test(i))return!1;var o=void 0===n.__path&&Object.defineProperty(n,"__path",{value:i});for(var a in n)Object.getOwnPropertyDescriptor(n,a).set||("object"==typeof n[a]&&t(n[a],i+"."+a),r(n,a),e.$e.emit(i+"."+a,n[a]));return o};e.$e={WATCH:{},get:t=>e.$e.WATCH[t]||(e.$e.WATCH[t]=[]),on:(t,n)=>e.$e.get(t).push(n),emit(t,n){for(var r=e.$e.get(t),i=r.length,o=0;o<i;o++)r[o](t,n)}};var r=function(t,r,i){var o=t[r],a=t.__path+"."+r,s=function(t){var r;return o!==t&&(Array.isArray(o)?(this&&this.constructor===String?r=Array.prototype[this].apply(o,arguments):u(o=t,s),n(o,a),e.$e.emit(a,o),r):("object"==typeof t?(o=c(t),n(o,a),e.$e.emit(a,o)):(n(o=t,a),e.$e.emit(a,o)),t))};Array.isArray(o)&&u(o,s),delete t[r]};for(var i in t.state){if(void 0!==e[i])throw new Error("[Radi.js] Err: Trying to write state for reserved variable `"+i+"`");e[i]=t.state[i]}for(var i in t.props){if(void 0!==e[i])throw new Error("[Radi.js] Err: Trying to write prop for reserved variable `"+i+"`");_(t.props[i])?(e[i]=t.props[i].get(),t.props[i].parent&&t.props[i].parent().$e.on(t.props[i].path,(t,n)=>{e[i]=n})):e[i]=t.props[i]}for(var i in n(e,"this"),t.actions){if(void 0!==e[i])throw new Error("[Radi.js] Error: Trying to write action for reserved variable `"+i+"`");e[i]=function(){return s?null:t.actions[this].apply(e,arguments)}.bind(i)}return e.$id=f++,e.$name=t.name,e.$state=t.state||{},e.$props=t.props||{},e.$actions=t.actions||{},e.$html=document.createDocumentFragment(),e.$parent=null,e.$view=new Function("r","list","ll","cond","return "+t.$view)(N.bind(e),O.bind(e),W.bind(e),P.bind(e)),e.$link=e.$view(),e.$html.appendChild(e.$link),e.$render=function(){return e.mount(),e.$html},e.mount=function(){"function"==typeof e.$actions.onMount&&e.$actions.onMount.call(e),p.push(e)},e.unmount=function(){"function"==typeof e.$actions.onDestroy&&e.$actions.onDestroy.call(e);for(var t=0;t<p.length;t++)if(p[t].$id===e.$id){p.splice(t,1);break}return e.$link},e.$link.unmount=e.unmount.bind(e),e.$link.mount=e.mount.bind(e),e}(this.o)}};x.prototype.props=function(t){for(var e in t)void 0===this.o.props[e]&&console.warn("[Radi.js] Warn: Creating a prop `",e,"` that is not defined in component"),this.o.props[e]=t[e];return this};var T=j("");const O=function(t,e){if(!t)return"";var n,r=this,i=document.createDocumentFragment(),o=T.cloneNode();i.appendChild(o);var a,s=t.source[t.prop];if(a=s,!0===Array.isArray(a))for(var c=0;c<s.length;c++)i.appendChild(e.call(r,s[c],c));else{c=0;for(var l in s)i.appendChild(e.call(r,s[l],l,c)),c++}n=i.lastChild;if(t.path){var u=s.length;r.$e.on(t.path,function(o,a){!function(o,a){if(o>0){for(var s=a.length,c=s-o;c<s;c++)i.appendChild(e.call(r,t.source[t.prop][c],c));var l=i.lastChild;n.parentElement.insertBefore(i,n.nextSibling),n=l}else if(o<0)for(c=0;c<Math.abs(o);c++){var u=n.previousSibling;n.parentElement.removeChild(n),n=u}}(a.length-u,a),u=a.length})}return i};function D(t,e,n,r){this.path=(n||t.__path)+"."+e,this.get=(()=>t[e]),this.source=t,this.prop=e,this.parent=(()=>r)}var F=0;const M=function(t,e,n){var r={s:null,a:[],t:[],f:t.toString()},i=this;if(1===n.length&&t.toString().replace(/(function \(\)\{ return |\(|\)|\; \})/g,"").trim()===n[0])return new D(e[0][0],e[0][1],null,this);var o=e.length;r.s=t.call(this),r.a=new Array(o),r.t=new Array(o),r.__path="$link-"+F,F+=1;for(var a=0;a<o;a++)r.a[a]=e[a][0][e[a][1]],r.t[a]="$rdi["+a+"]",r.f=r.f.replace(n[a],r.t[a]),function(t,e,n,r){i.$e.on(t,(t,o)=>{e.a[r]=o;var a=e.f.call(i,e.a);e.s!==a&&(e.s=a,i.$e.emit(n,e.s))})}(e[a][0].__path+"."+e[a][1],r,r.__path+".s",a);return r.f=new Function("$rdi","return "+r.f+"();"),o<=0?r.s:new D(r,"s",r.__path,this)},P=function(t,e){return new R(t,e,this)};var R=function(t,e,n){this.cases=[{a:t,e:e}],this.w=[],this.cache=[],this.els=T.cloneNode(),_(t)&&this.w.push(t),this.watch=function(t){for(var e in this.w)this.cache[e]=this.w[e].get(),function(e){n.$e.on(this.w[e].path,(n,r)=>{if(console.log(this.w[e].path,this.cache[e]==r,this.cache[e],r),this.cache[e]==r)return!1;t(r),this.cache[e]=r})}.call(this,e)},this.__do=function(){var t={id:null};for(var e in this.cases){if(_(this.cases[e].a)?this.cases[e].a.get():this.cases[e].a){t.id=e,t.r=this.cases[e].e;break}}return void 0===t.r&&(t.r=this.els),t}};R.prototype.elseif=function(t,e){return this.cases.push({a:t,e:e}),_(t)&&this.w.push(t),this},R.prototype.cond=R.prototype.elseif,R.prototype.else=function(t){return this.els=t,this};const W=function(t,e,n){return e?M.call(this,t,e,n.split(",")):t};t.version="0.1.0",t.activeComponents=p,t.text=j,t.r=N,t.component=function(t){for(var o=t.view.toString().replace(e,""),a=n.exec(o),s="",c=0;null!==a;){var l=a.index,u=a.input,f=1,p=0;const t=u.length;for(var h=l+2;h<t;h++){var d=u.charCodeAt(h);if(d===r?f+=1:d===i&&(p+=1),f===p)break}var v=u.substr(l,h+1-l),y=v.match(/[a-zA-Z_$]+(?:\.\w+(?:\[.*\])?)+/g)||[],g=[];for(h=0;h<y.length;h++){var m=y[h].split(".");if(m.length>1){var $=m.splice(-1)[0];g.push("["+m.join(".")+', "'+$+'"]')}}g=g.join(",");var b="ll(function(){ return "+v.substr(1)+"; },["+g+'], "'+y.join(",")+'")';s=(s=s.concat(o.substr(c,l-c))).concat(b),c=l+v.length,a=n.exec(o)}return s=s.concat(o.substr(c,o.length-c)),t.$view=s,x.bind(this,t)},t.mount=function(t,e){const n=e.constructor===String?document.getElementById(e):e;var r=t instanceof x?t.__radi().$render():t;return n.appendChild(r),r},t.list=O,t.link=M,t.cond=P,t.l=function(t){return t},t.ll=W,t.freeze=(()=>{s=!0}),t.unfreeze=(()=>{s=!1;for(var t=0;t<p.length;t++)"function"==typeof p[t].onMount&&p[t].onMount.call(p[t])})});
//# sourceMappingURL=radi.js.map