!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports):"function"==typeof define&&define.amd||n(t.radi={})}(this,function(t){"use strict";var n=new EventSpitter,e=/((\/\/.*$)|(\/\*[\s\S]*?\*\/))/gm,r=/\bl\(/g,i="(".charCodeAt(0),o=")".charCodeAt(0),a="#".charCodeAt(0),s=".".charCodeAt(0),c=!1,u=function(t){return!0===Array.isArray(t)};function f(t){var n,e;if("object"==typeof t){if(null===t)return t;if("[object Array]"===Object.prototype.toString.call(t)){var r=t.length;for(e=new Array(r),n=0;n<r;n++)"object"==typeof t[n]?e[n]=f(t[n]):e[n]=t[n]}else for(n in e={},t)t.hasOwnProperty(n)&&(t[n],e[n]=f(t[n]))}else e=t;return e}Object.defineProperties(Object,{relocate:{configurable:!0,enumerable:!1,value:function(t,n){for(var e in n){const i=n[e];var r=!1;!i||"object"!=typeof i||i instanceof g?t[e]!==i&&(r=!0,t[e]=i):(void 0===t[e]&&(t[e]=i.constructor()),Object.relocate(t[e],i),r=!0),r&&l(t,e)}},writable:!0}});var l=function t(n,e){if("object"!=typeof n||!n)return!1;if("this.$view"===e)return!1;if("this.$props"===e)return!1;if("this.$state"===e)return!1;if("this.$link"===e)return!1;if("this.$html"===e)return!1;var r={__r:{value:!0}};void 0===n.__path&&(r.__path={value:e});var i=Object.defineProperties(n,r);if("object"==typeof n)for(var o in n)"object"==typeof n&&t(n[o],e+"."+o);return i},h=function(t,n){var e=function(t){for(var n=null,e=null,r=null,i=0,o="",c=0;c<=t.length;c++){var u=t.charCodeAt(c),f=u===a,l=u===s;f||l||!u?(0===i?n=0===c?"div":o:1===i?e=o:r?r+=" "+o:r=o,f?i=1:l&&(i=2),o=""):o+=t[c]}return{tag:n,id:e,className:r}}(t),r=e.tag,i=e.id,o=e.className,c=n?document.createElementNS(n,r):document.createElement(r);return i&&(c.id=i),o&&(n?c.setAttribute("class",o):c.className=o),c};function p(t,e,r){if("this.$view"===r||"this.$props"===r||"this.$state"===r||"this.$link"===r||"this.$html"===r)return!1;for(var i in t){var o=r+"."+i;void 0===e[i]?n.emit(o,e[i]):JSON.stringify(t[i])!==JSON.stringify(e[i])&&("object"!=typeof e[i]||null===e[i]?n.emit(o,e[i]):(u(e[i]),n.emit(o,e[i]),p(t[i],e[i],o)))}}Array.isArray||(Array.isArray=function(t){return"[object Array]"===Object.prototype.toString.call(t)});var d=0;const v=[];var g=function(t){var n={};for(var e in t.state){if(void 0!==n[e])throw new Error("[Radi.js] Err: Trying to write state for reserved variable `"+e+"`");n[e]=t.state[e]}for(var e in t.props){if(void 0!==n[e])throw new Error("[Radi.js] Err: Trying to write prop for reserved variable `"+e+"`");N(t.props[e])?(n[e]=t.props[e].get(),t.props[e].watch(function(t){n[e]=t})):n[e]=t.props[e]}for(var e in function t(n,e){var r=void 0===e?"this":e;if(n&&"object"==typeof n){var i={__r:{value:!0}};void 0===n.__path&&(i.__path={value:r});var o=Object.defineProperties(n,i);for(var a in n)t(n[a],r+"."+a);return o}return!1}(n),t.actions){if(void 0!==n[e])throw new Error("[Radi.js] Error: Trying to write action for reserved variable `"+e+"`");n[e]=function(){if(c)return null;var t=f(n),e=this.apply(n,arguments);return l(n,"this"),p(t,n,"this"),e}.bind(t.actions[e])}return n.$id=d++,n.$name=t.name,n.$state=t.state||{},n.$props=t.props||{},n.$actions=t.actions||{},n.$html=document.createDocumentFragment(),n.$view=new Function("r","list","l","cond","return "+t.$view)(M.bind(n),P.bind(n),J.bind(n),U.bind(n)),n.$link=n.$view(),n.$html.appendChild(n.$link),n.$render=function(){return n.mount(),n.$html},n.mount=function(){console.log("MOUNT",n.$name),"function"==typeof n.$actions.onMount&&n.$actions.onMount.call(n),v.push(n)},n.unmount=function(){console.log("UNMOUNT",n.$name),"function"==typeof n.$actions.onDestroy&&n.$actions.onDestroy.call(n);for(var t=0;t<v.length;t++)if(v[t].$id===n.$id){v.splice(t,1);break}return n.$link},n.$link.unmount=n.unmount.bind(n),n.$link.mount=n.mount.bind(n),n},m=function t(n){if("function"==typeof n.unmount&&n.unmount(),n.children&&n.children.length>0)for(var e=0;e<n.children.length;e++)t(n.children[e])},y=function t(n){if("function"==typeof n.mount&&n.mount(),n.children&&n.children.length>0)for(var e=0;e<n.children.length;e++)t(n.children[e])},b=function(t,n,e){var r=$(t);if(N(e))r.style[n]=e.get(),e.watch(t=>{});else if(void 0!==e)r.style[n]=e;else if(_(n))r.setAttribute("style",n);else for(var i in n)b(r,i,n[i])},w=function(t,e,r){var i=this,o=$(t);if(void 0!==r)if("style"===e)b(o,r);else if("model"===e&&N(r)){var a=r.get();o.value=a,o.oninput=function(){r.source[r.prop]=a=o.value,n.emit(r.path,o.value)},r.watch(function(t){})}else if(C(r))o[e]=function(t){r.call(i,t)};else if(N(r)){var s=r.get();C(s)?o[e]=function(t){r.get().call(i,t)}:(o.setAttribute(e,r.get()),r.watch(function(t){}))}else o.setAttribute(e,r);else for(var c in e)w.call(this,o,c,e[c])},$=function(t){return t.nodeType&&t||!t.el&&t||$(t.el)},_=function(t){return"string"==typeof t},j=function(t){return"number"==typeof t},C=function(t){return"function"==typeof t},A=function(t){return t&&t.nodeType},N=function(t){return t&&t instanceof R},E=function(t){return t&&t instanceof B},O=function(t){return t&&t.__radi};const S=function(t){return document.createTextNode(t)};var k=function(t,e){for(var r=0;r<e.length;r++){var i=e[r];if(0===i||i)if(O(i))t.appendChild(i.__radi().$render());else if(E(i)){var o,a=i.__do(),s=a.id;o=O(a.r)?a.r.__radi().$render():"function"==typeof a.r?a.r():_(a.r)||j(a.r)?S(a.r):a.r,t.appendChild(o),function(t){t.watch(function(n){var e,r=t.__do();if(s===r.id)return!1;e=O(r.r)?r.r.__radi().$render():"function"==typeof r.r?r.r():_(r.r)||j(r.r)?S(r.r):r.r,m(o),o.parentNode.replaceChild(e,o),y(o=e),s=r.id})}(i)}else if("function"==typeof i)i.call(this,t);else if(_(i)||j(i))t.appendChild(S(i));else if(A($(i)))t.appendChild(i);else if(Array.isArray(i))k.call(this,t,i);else if(N(i)){var c=i.get();let e=S(c);t.appendChild(e),i.path&&function(t){n.on(i.path,function(n,e){if(e===t)return!1;t=e})}(c)}else"object"==typeof i&&w.call(this,t,i)}},x={},T=function(t){return x[t]||(x[t]=h(t))};const M=function(t){for(var n,e=[],r=arguments.length-1;r-- >0;)e[r]=arguments[r+1];return n=_(t)?T(t).cloneNode(!1):A(t)?t.cloneNode(!1):document.createDocumentFragment(),k.call(this,n,e),n};M.extend=function(t){for(var n=[],e=arguments.length-1;e-- >0;)n[e]=arguments[e+1];var r=T(t);return M.bind.apply(M,[this,r].concat(n))};var D=function(t){this.o={name:t.name,state:f(t.state),props:f(t.props),actions:t.actions,view:t.view,$view:t.$view},this.__radi=function(){return new g(this.o)}};D.prototype.props=function(t){for(var n in t)void 0===this.o.props[n]&&console.warn("[Radi.js] Warn: Creating a prop `",n,"` that is not defined in component"),this.o.props[n]=t[n];return this};var F=S("");const P=function(t,e){if(!t)return"";var r,i=this,o=document.createDocumentFragment(),a=F.cloneNode();o.appendChild(a);var s=t.source[t.prop];if(u(s))for(var c=0;c<s.length;c++)o.appendChild(e.call(i,s[c],c));else{c=0;for(var f in s)o.appendChild(e.call(i,s[f],f,c)),c++}r=o.lastChild;if(t.path){var l=s.length;n.on(t.path,function(t,n){!function(t,n){if(t>0){for(var a=n.length-t;a<n.length;a++)o.appendChild(e.call(i,n[a],a));var s=o.lastChild;r.parentElement.insertBefore(o,r.nextSibling),r=s}else if(t<0)for(a=0;a<Math.abs(t);a++){var c=r.previousSibling;r.parentElement.removeChild(r),r=c}}(n.length-l,n),l=n.length})}return o};function R(t,e){this.path=t.__path+"."+e,this.get=(()=>t[e]),this.source=t,this.prop=e;var r=this.path;this.watch=function(i){var o=t[e];r&&n.on(r,function(n){if(t[e]===o)return!1;t[e],o=t[e]})}}const z=function(t,n,e){var r,i={s:null},o=this,a=t.bind(this);if(1===e.length&&t.toString().replace(/(function \(\)\{ return |\(|\)|\; \})/g,"").trim()===e[0])return new R(n[0][0],n[0][1]);for(var s=0;s<n.length;s++){var c=n[s][0][n[s][1]];N(c)&&(r=!0,n[s].watch(function(){i.s=a(o)}))}return i.s=a(o),r?new R(i,"s"):i.s},U=function(t,n){return new B(t,n)};var B=function(t,n){this.cases=[{a:t,e:n}],this.w=[],this.els=F.cloneNode(),N(t)&&this.w.push(t),this.watch=function(t){for(var n in this.w)this.w[n].watch(t)},this.__do=function(){var t={id:null};for(var n in this.cases){if(N(this.cases[n].a)?this.cases[n].a.get():this.cases[n].a){t.id=n,t.r=this.cases[n].e;break}}return void 0===t.r&&(t.r=this.els),t}};B.prototype.elseif=function(t,n){return this.cases.push({a:t,e:n}),N(t)&&this.w.push(t),this},B.prototype.cond=B.prototype.elseif,B.prototype.else=function(t){return this.els=t,this};const J=function(t,n,e){return n?z.call(this,t,n,e.split(",")):t};t.version="0.0.5",t.activeComponents=v,t.text=S,t.r=M,t.component=function(t){for(var n=t.view.toString().replace(e,""),a=r.exec(n),s=[],c=0;null!==a;){var u=a.index,f=a.input,l=1,h=0;const t=f.length;for(var p=u+2;p<t;p++){var d=f.charCodeAt(p);if(d===i?l+=1:d===o&&(h+=1),l===h)break}var v=f.substr(u,p+1-u),g=v.match(/[a-zA-Z_$]+(?:\.\w+(?:\[.*\])?)+/g)||[],m=[];for(p=0;p<g.length;p++){var y=g[p].split(".");if(y.length>1){var b=y.splice(-1)[0];m.push("["+y+', "'+b+'"]')}}m=m.join(",");var w="l(function(){ return "+v.substr(1)+"; },["+m+'], "'+g.join(",")+'")';s.push(n.substr(c,u-c)),s.push(w),c=u+v.length,a=r.exec(n)}return s.push(n.substr(c,n.length-c)),t.$view=s.join(""),D.bind(this,t)},t.mount=function(t,n){const e=n.constructor===String?document.getElementById(n):n;var r=t instanceof D?t.__radi().$render():t;return e.appendChild(r),r},t.list=P,t.link=z,t.cond=U,t.l=J,t.freeze=(()=>{c=!0}),t.unfreeze=(()=>{c=!1;for(var t=0;t<v.length;t++)"function"==typeof v[t].onMount&&v[t].onMount.call(v[t])})});
//# sourceMappingURL=radi.js.map