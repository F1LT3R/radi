!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd||e(t.radi={})}(this,function(t){"use strict";var e=/((\/\/.*$)|(\/\*[\s\S]*?\*\/))/gm,n=/\bl\(/g,r="(".charCodeAt(0),i=")".charCodeAt(0),o="#".charCodeAt(0),a=".".charCodeAt(0),s=0,c=1,u=2,l=!1,f=function(t){return!0===Array.isArray(t)};function p(t){var e,n;if("object"==typeof t){if(null===t)return t;if("[object Array]"===Object.prototype.toString.call(t)){var r=t.length;for(n=new Array(r),e=0;e<r;e++)"object"==typeof t[e]?n[e]=p(t[e]):n[e]=t[e]}else for(e in n={},t)t.hasOwnProperty(e)&&(t[e],n[e]=p(t[e]))}else n=t;return n}function h(t,e){var n=function(t){for(var e=null,n=null,r=null,i=s,l="",f=0;f<=t.length;f++){var p=t.charCodeAt(f),h=p===o,d=p===a;h||d||!p?(i===s?e=0===f?"div":l:i===c?n=l:r?r+=" "+l:r=l,h?i=c:d&&(i=u),l=""):l+=t[f]}return{tag:e,id:n,className:r}}(t),r=n.tag,i=n.id,l=n.className,f=e?document.createElementNS(e,r):document.createElement(r);return i&&(f.id=i),l&&(e?f.setAttribute("class",l):f.className=l),f}Array.isArray||(Array.isArray=function(t){return"[object Array]"===Object.prototype.toString.call(t)});var d=function(t,e){return!t.__radi&&Object.defineProperties(t,{__radi:{value:!0},reverse:{value:e.bind("reverse")},push:{value:e.bind("push")},splice:{value:e.bind("splice")},pop:{value:e.bind("pop")},shift:{value:e.bind("shift")}})},v=0;const g=[];var $=function(t){var e={$state:{},__path:"this"};function n(t,e){t.__path}function r(t,n){Object.getOwnPropertyDescriptor(t,n).set||function(t,n,r){var o=t[n],a=t.__path+"."+n,s=function(t){if(o!==t){if(Array.isArray(o)){var n;if(this&&this.constructor===String){var t=p(o);n=Array.prototype[this].apply(t,arguments)}var r=o.length,s=t.length,c=s-r;if(c<0)for(var u=r;u>r+c;u--)delete o[u-1];return o.length=s,i(o,t),e.$e.emit(a,o),n}return"object"==typeof t?(i(o,t),e.$e.emit(a,o)):(o=t,e.$e.emit(a,o)),t}return!1};Array.isArray(o)&&d(o,s);delete t[n]}(t,n)}function i(t,e){if("object"!=typeof t||!t)return e;var o=t.__path;for(var a in e)"object"==typeof e[a]?(void 0===t[a]&&(t[a]=f(e[a])?[]:{},n(t[a],o.concat(".").concat(a))),i(t[a],e[a])):t[a]=e[a],r(t,a)}for(var o in e.$e={WATCH:{},get:t=>e.$e.WATCH[t]||(e.$e.WATCH[t]=[]),on:(t,n)=>e.$e.get(t).push(n),emit(t,n){for(var r=e.$e.get(t),i=r.length,o=0;o<i;o++)r[o](t,n)}},t.state){if(void 0!==e.$state[o])throw new Error("[Radi.js] Err: Trying to write state for reserved variable `"+o+"`");e.$state[o]=t.state[o]}for(var o in t.props){if(void 0!==e.$state[o])throw new Error("[Radi.js] Err: Trying to write prop for reserved variable `"+o+"`");j(t.props[o])?(e.$state[o]=t.props[o].get(),t.props[o].parent&&t.props[o].parent().$e.on(t.props[o].path,(t,n)=>{e.$state[o]=n})):e.$state[o]=t.props[o]}for(var o in i(e,e.$state),t.actions){if(void 0!==e[o])throw new Error("[Radi.js] Error: Trying to write action for reserved variable `"+o+"`");e[o]=function(){return l?null:t.actions[this].apply(e,arguments)}.bind(o)}return e.$id=v++,e.$name=t.name,e.$state=t.state||{},e.$props=t.props||{},e.$actions=t.actions||{},e.$html=document.createDocumentFragment(),e.$parent=null,e.$view=new Function("r","list","ll","cond","return "+t.$view)(D.bind(e),F.bind(e),B.bind(e),H.bind(e)),e.$link=e.$view(),e.$html.appendChild(e.$link),e.$render=function(){return e.mount(),e.$html},e.mount=function(){"function"==typeof e.$actions.onMount&&e.$actions.onMount.call(e),g.push(e)},e.unmount=function(){"function"==typeof e.$actions.onDestroy&&e.$actions.onDestroy.call(e);for(var t=0;t<g.length;t++)if(g[t].$id===e.$id){g.splice(t,1);break}return e.$link},e.$link.unmount=e.unmount.bind(e),e.$link.mount=e.mount.bind(e),e},y=function(t,e,n){var r=this,i=b(t);if(j(n)){var o=n.get();i.style[e]=o,function(t,e,n){r.$e.on(n.path,function(e,n){if(n===t)return!1;t=n})}(o,0,n)}else if(void 0!==n)i.style[e]=n;else if(_(e))i.setAttribute("style",e);else for(var a in e)y.call(this,i,a,e[a])},m=function(t,e,n){var r=this,i=b(t);if(void 0!==n)if("style"===e)y.call(this,i,n);else if("model"===e&&j(n)){var o=n.get();i.value=o,i.oninput=function(){n.source[n.prop]=o=i.value,r.$e.emit(n.path,i.value)},function(t,e,n){r.$e.on(n.path,function(e,n){if(n===t)return!1;t=n})}(o,0,n)}else if(A(n))i[e]=function(t){n.call(r,t)};else if(j(n)){var a=n.get();if(A(a))i[e]=function(t){n.get().call(r,t)};else{o=n.get();i.setAttribute(e,o);!function(t,e,n){r.$e.on(n.path,function(e,n){if(n===t)return!1;t=n})}(o,0,n)}}else i.setAttribute(e,n);else for(var s in e)m.call(this,i,s,e[s])},b=function(t){return t.nodeType&&t||!t.el&&t||b(t.el)},_=function(t){return"string"==typeof t},w=function(t){return"number"==typeof t},A=function(t){return"function"==typeof t},C=function(t){return t&&t.nodeType},j=function(t){return t&&t instanceof R},E=function(t){return t&&t instanceof P},k=function(t){return t&&t.__radi};const N=function(t){return document.createTextNode(t)};var S=function(t,e){for(var n=this,r=0;r<e.length;r++){var i=e[r];if(0===i||i)if(k(i))t.appendChild(i.__radi().$render());else if(E(i)){var o,a=i.__do(),s=a.id;o=k(a.r)?a.r.__radi().$render():"function"==typeof a.r?a.r():_(a.r)||w(a.r)?N(a.r):a.r,t.appendChild(o),function(t){t.watch(function(e){var n,r=t.__do();if(s===r.id)return!1;n=k(r.r)?r.r.__radi().$render():"function"==typeof r.r?r.r():_(r.r)||w(r.r)?N(r.r):r.r,o.parentNode.replaceChild(n,o),o=n,s=r.id})}(i)}else if("function"==typeof i)i.call(this,t);else if(_(i)||w(i))t.appendChild(N(i));else if(C(b(i)))t.appendChild(i);else if(Array.isArray(i))S.call(this,t,i);else if(j(i)){var c=i.get();let e=N(c);t.appendChild(e),function(t,e){n.$e.on(e.path,function(e,n){if(n===t)return!1;t=n})}(c,i)}else"object"==typeof i&&m.call(this,t,i)}},x={},T=function(t){return x[t]||(x[t]=h(t))};const D=function(t){for(var e,n=[],r=arguments.length-1;r-- >0;)n[r]=arguments[r+1];return e=_(t)?T(t).cloneNode(!1):C(t)?t.cloneNode(!1):document.createDocumentFragment(),S.call(this,e,n),e};D.extend=function(t){for(var e=[],n=arguments.length-1;n-- >0;)e[n]=arguments[n+1];var r=T(t);return D.bind.apply(D,[this,r].concat(e))};var O=function(t){this.o={name:t.name,state:p(t.state),props:p(t.props),actions:t.actions,view:t.view,$view:t.$view},this.__radi=function(){return new $(this.o)}};O.prototype.props=function(t){for(var e in t)void 0===this.o.props[e]&&console.warn("[Radi.js] Warn: Creating a prop `",e,"` that is not defined in component"),this.o.props[e]=t[e];return this};var M=N("");const F=function(t,e){if(!t)return"";var n,r=this,i=document.createDocumentFragment(),o=M.cloneNode();i.appendChild(o);var a=t.source[t.prop];if(f(a))for(var s=0;s<a.length;s++)i.appendChild(e.call(r,a[s],s));else{s=0;for(var c in a)i.appendChild(e.call(r,a[c],c,s)),s++}n=i.lastChild;if(t.path){var u=a.length;r.$e.on(t.path,function(o,a){!function(o,a){if(o>0){for(var s=a.length,c=s-o;c<s;c++)i.appendChild(e.call(r,t.source[t.prop][c],c));var u=i.lastChild;n.parentElement.insertBefore(i,n.nextSibling),n=u}else if(o<0)for(c=0;c<Math.abs(o);c++){var l=n.previousSibling;n.parentElement.removeChild(n),n=l}}(a.length-u,a),u=a.length})}return i};function R(t,e,n,r){this.path=(n||t.__path)+"."+e,this.get=(()=>t[e]),this.source=t,this.prop=e,this.parent=(()=>r)}var W=0;const z=function(t,e,n){var r={},i=this;if(1===n.length&&t.toString().replace(/(function \(\)\{ return |\(|\)|\; \})/g,"").trim()===n[0])return new R(e[0][0],e[0][1]);var o=e.length;r.s=t.call(i),r.__path="$link-"+W++;for(var a=0;a<o;a++)!function(e,n,r,o){i.$e.on(e,e=>{var o=t.call(i);n.s!==o&&(n.s=o,i.$e.emit(r,n.s))})}(e[a][0].__path+"."+e[a][1],r,r.__path.concat(".s"));return o<=0?r.s:new R(r,"s",null,this)},H=function(t,e){return new P(t,e,this)};var P=function(t,e,n){this.cases=[{a:t,e:e}],this.w=[],this.cache=[],this.els=M.cloneNode(),j(t)&&this.w.push(t),this.watch=function(t){for(var e in this.w)(function(e){n.$e.on(this.w[e].path,n=>{t(this.w[e].get())})}).call(this,e)},this.__do=function(){var t={id:null};for(var e in this.cases){if(j(this.cases[e].a)?this.cases[e].a.get():this.cases[e].a){t.id=e,t.r=this.cases[e].e;break}}return void 0===t.r&&(t.r=this.els),t}};P.prototype.elseif=function(t,e){return this.cases.push({a:t,e:e}),j(t)&&this.w.push(t),this},P.prototype.cond=P.prototype.elseif,P.prototype.else=function(t){return this.els=t,this};const B=function(t,e,n){return e?z.call(this,t,e,n.split(",")):t};t.version="0.1.0",t.activeComponents=g,t.text=N,t.r=D,t.component=function(t){for(var o=t.view.toString().replace(e,""),a=n.exec(o),s="",c=0;null!==a;){var u=a.index,l=a.input,f=1,p=0;const t=l.length;for(var h=u+2;h<t;h++){var d=l.charCodeAt(h);if(d===r?f+=1:d===i&&(p+=1),f===p)break}var v=l.substr(u,h+1-u),g=v.match(/[a-zA-Z_$]+(?:\.\w+(?:\[.*\])?)+/g)||[],$=[];for(h=0;h<g.length;h++){var y=g[h].split(".");if(y.length>1){var m=y.splice(-1)[0];$.push("["+y.join(".")+', "'+m+'"]')}}$=$.join(",");var b="ll(function(){ return "+v.substr(1)+"; },["+$+'], "'+g.join(",")+'")';s=(s=s.concat(o.substr(c,u-c))).concat(b),c=u+v.length,a=n.exec(o)}return s=s.concat(o.substr(c,o.length-c)),t.$view=s,O.bind(this,t)},t.mount=function(t,e){const n=e.constructor===String?document.getElementById(e):e;var r=t instanceof O?t.__radi().$render():t;return n.appendChild(r),r},t.list=F,t.link=z,t.cond=H,t.l=function(t){return t},t.ll=B,t.freeze=(()=>{l=!0}),t.unfreeze=(()=>{l=!1;for(var t=0;t<g.length;t++)"function"==typeof g[t].onMount&&g[t].onMount.call(g[t])})});
//# sourceMappingURL=radi.js.map