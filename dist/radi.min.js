!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd||t(e.radi={})}(this,function(e){"use strict";var t=/((\/\/.*$)|(\/\*[\s\S]*?\*\/))/gm,n=/\bl\(/g,r="(".charCodeAt(0),i=")".charCodeAt(0),o="#".charCodeAt(0),a=".".charCodeAt(0),u=0,l=1,c=2,s=!1;function f(e){return!0===Array.isArray(e)}function p(e){var t,n;if("object"==typeof e){if(null===e)return e;if("[object Array]"===Object.prototype.toString.call(e)){var r=e.length;for(n=new Array(r),t=0;t<r;t++)"object"==typeof e[t]?n[t]=p(e[t]):n[t]=e[t]}else for(t in n={},e)e.hasOwnProperty(t)&&(e[t],n[t]=p(e[t]))}else n=e;return n}function h(e,t){var n=function(e){for(var t=null,n=null,r=null,i=u,s="",f=0;f<=e.length;f++){var p=e.charCodeAt(f),h=p===o,d=p===a;h||d||!p?(i===u?t=0===f?"div":s:i===l?n=s:r?r+=" "+s:r=s,h?i=l:d&&(i=c),s=""):s+=e[f]}return{tag:t,id:n,className:r}}(e),r=n.tag,i=n.id,s=n.className,f=t?document.createElementNS(t,r):document.createElement(r);return i&&(f.id=i),s&&(t?f.setAttribute("class",s):f.className=s),f}Array.isArray||(Array.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)});var d=function(e,t){return!(!f(e)||e.__radi)&&Object.defineProperties(e,{__radi:{value:!0},reverse:{value:t.bind("reverse")},push:{value:t.bind("push")},splice:{value:t.bind("splice")},pop:{value:t.bind("pop")},shift:{value:t.bind("shift")}})},v=0;const m=[];function y(e){if("function"==typeof e.unmount&&e.unmount(),e.children&&e.children.length>0)for(var t=0;t<e.children.length;t++)y(e.children[t])}function $(e){if("function"==typeof e.mount&&e.mount(),e.children&&e.children.length>0)for(var t=0;t<e.children.length;t++)$(e.children[t])}function b(e,t,n){var r=this,i=g(e);if(void 0!==n)if("style"===t)(function e(t,n,r){var i=this,o=g(t);if(j(r)){var a=r.get();o.style[n]=a,function(e,t,n){i.$e.on(n.path,function(t,n){if(n===e)return!1;e=n})}(a,0,r)}else if(void 0!==r)o.style[n]=r;else if(w(n))o.setAttribute("style",n);else for(var u in n)e.call(this,o,u,n[u])}).call(this,i,n);else if("model"===t&&j(n)){var o=n.get();i.value=o,i.oninput=function(){n.source[n.prop]=o=i.value,r.$e.emit(n.path,i.value)},function(e,t,n){r.$e.on(n.path,function(t,n){if(n===e)return!1;e=n})}(o,0,n)}else if(A(n))i[t]=function(e){n.call(r,e)};else if(j(n)){var a=n.get();if(A(a))i[t]=function(e){n.get().call(r,e)};else!1!==(o=n.get())&&("html"===t?i.innerHTML=o:i.setAttribute(t,o)),function(e,t,n){r.$e.on(n.path,function(t,n){if(n===e)return!1;e=n})}(o,0,n)}else!1!==o&&("html"===t?i.innerHTML=n:i.setAttribute(t,n));else for(var u in t)b.call(this,i,u,t[u])}var g=function(e){return e.nodeType&&e||!e.el&&e||g(e.el)},w=function(e){return"string"==typeof e},_=function(e){return"number"==typeof e},A=function(e){return"function"==typeof e},C=function(e){return e&&e.nodeType},j=function(e){return e&&e instanceof F},N=function(e){return e&&e instanceof B},E=function(e){return e&&e.__radi};const k=function(e){return document.createTextNode(e)};var O={};function S(e){return O[e]||(O[e]=h(e))}function T(e){for(var t,n=[],r=arguments.length-1;r-- >0;)n[r]=arguments[r+1];return t=w(e)?S(e).cloneNode(!1):C(e)?e.cloneNode(!1):document.createDocumentFragment(),function e(t,n){for(var r=this,i=0;i<n.length;i++){var o=n[i];if(0===o||o)if(E(o))t.appendChild(o.__radi().$render());else if(N(o)){var a,u=o.__do(),l=u.id;a=E(u.r)?u.r.__radi().$render():"function"==typeof u.r?u.r():w(u.r)||_(u.r)?k(u.r):u.r,t.appendChild(a),function(e){e.watch(function(t){var n,r=e.__do();if(l===r.id)return!1;n=E(r.r)?r.r.__radi().$render():"function"==typeof r.r?r.r():w(r.r)||_(r.r)?k(r.r):r.r,y(a),a.parentNode.replaceChild(n,a),$(a=n),l=r.id})}(o)}else if("function"==typeof o)o.call(this,t);else if(w(o)||_(o))t.appendChild(k(o));else if(C(g(o)))t.appendChild(o);else if(Array.isArray(o))e.call(this,t,o);else if(j(o)){var c=o.get();let e=k(c);t.appendChild(e),function(e,t){r.$e.on(t.path,function(t,n){if(n===e)return!1;e=n})}(c,o)}else"object"==typeof o&&b.call(this,t,o)}}.call(this,t,n),t}function x(e){var o=e.view.toString().replace(t,""),a=n.exec(o),u=0;for(e.$view="";null!==a;){var l=a.index,c=a.input,s=1,f=0;const t=c.length;for(var p=l+2;p<t;p++){var h=c.charCodeAt(p);if(h===r?s+=1:h===i&&(f+=1),s===f)break}var d=c.substr(l,p+1-l),v=d.match(/[a-zA-Z_$]+(?:\.\w+(?:\[.*\])?)+/g)||[],m=[];for(p=0;p<v.length;p++){var y=v[p].split(".");if(y.length>1){var $=y.splice(-1)[0];m.push("["+y.join(".")+', "'+$+'"]')}}m=m.join(",");var b="ll(function(){ return "+d.substr(1)+"; },["+m+'], "'+v.join(",")+'")';e.$view=e.$view.concat(o.substr(u,l-u)).concat(b),u=l+d.length,a=n.exec(o)}return e.$view=e.$view.concat(o.substr(u,o.length-u)),P.bind(this,e)}function P(e){this.o={name:e.name,state:p(e.state),props:p(e.props),actions:e.actions,view:e.view,$view:e.$view},this.__radi=function(){return new function(e){var t={__path:"this"};function n(e,i){var o;if("object"!=typeof e||!e)return!1;for(var a in o=void 0===e.__path&&Object.defineProperty(e,"__path",{value:i}),e)e.hasOwnProperty(a)&&!Object.getOwnPropertyDescriptor(e,a).set&&("object"==typeof e[a]&&n(e[a],i+"."+a),r(e,a,i.concat(".").concat(a)),t.$e.emit(i+"."+a,e[a]));return o}function r(e,r,i){var o=e[r],a=function(e){var r;return o!==e&&(Array.isArray(o)?(this&&this.constructor===String?r=Array.prototype[this].apply(o,arguments):d(o=e,a),n(o,i),t.$e.emit(i,o),r):("object"==typeof e?(n(o=p(e),i),t.$e.emit(i,o)):(n(o=e,i),t.$e.emit(i,o)),e))};Array.isArray(o)&&d(o,a),delete e[r]}for(var i in Object.defineProperties(t,{$e:{enumerable:!1,value:{WATCH:{},get:e=>t.$e.WATCH[e]||(t.$e.WATCH[e]=[]),on:(e,n)=>s?null:t.$e.get(e).push(n),emit(e,n){if(s)return null;for(var r=t.$e.get(e),i=r.length,o=0;o<i;o++)r[o](e,n)}}}}),e.state){if(void 0!==t[i])throw new Error("[Radi.js] Err: Trying to write state for reserved variable `"+i+"`");t[i]=e.state[i]}for(var i in e.props){if(void 0!==t[i])throw new Error("[Radi.js] Err: Trying to write prop for reserved variable `"+i+"`");j(e.props[i])?(t[i]=e.props[i].get(),e.props[i].parent&&e.props[i].parent().$e.on(e.props[i].path,(e,n)=>{t[i]=n})):t[i]=e.props[i]}for(var i in n(t,"this"),e.actions){if(void 0!==t[i])throw new Error("[Radi.js] Error: Trying to write action for reserved variable `"+i+"`");t[i]=function(){return s?null:e.actions[this].apply(t,arguments)}.bind(i)}return Object.defineProperties(t,{$id:{enumerable:!1,value:v++},$name:{enumerable:!1,value:e.name},$state:{enumerable:!1,value:e.state||{}},$props:{enumerable:!1,value:e.props||{}},$actions:{enumerable:!1,value:e.actions||{}},$html:{enumerable:!1,value:document.createDocumentFragment()},$parent:{enumerable:!1,value:null},$view:{enumerable:!1,value:new Function("r","list","ll","cond","return "+e.$view)(T.bind(t),z.bind(t),I.bind(t),W.bind(t))},$render:{enumerable:!1,value:function(){return t.mount(),t.$html}}}),Object.defineProperties(t,{$link:{enumerable:!1,value:t.$view()}}),t.$html.appendChild(t.$link),t.$html.destroy=function(){const e=t.$link.parentElement,n=e.cloneNode(!1);e.parentNode.insertBefore(n,e),t.unmount(),e.parentNode.removeChild(e)},t.mount=function(){"function"==typeof t.$actions.onMount&&t.$actions.onMount.call(t),m.push(t)},t.unmount=function(){"function"==typeof t.$actions.onDestroy&&t.$actions.onDestroy.call(t);for(var e=0;e<m.length;e++)if(m[e].$id===t.$id){m.splice(e,1);break}return t.$link},t.$link.unmount=t.unmount.bind(t),t.$link.mount=t.mount.bind(t),t}(this.o)}}T.extend=function(e){for(var t=[],n=arguments.length-1;n-- >0;)t[n]=arguments[n+1];var r=S(e);return T.bind.apply(T,[this,r].concat(t))},P.prototype.props=function(e){for(var t in e)void 0===this.o.props[t]&&console.warn("[Radi.js] Warn: Creating a prop `",t,"` that is not defined in component"),this.o.props[t]=e[t];return this};const M=function(e,t){const n=t.constructor===String?document.getElementById(t):t;var r=e instanceof P?e.__radi().$render():e;return n.appendChild(r),r};var D=k("");const z=function(e,t){if(!e)return"";var n,r=this,i=document.createDocumentFragment(),o=D.cloneNode();i.appendChild(o);var a=e.source[e.prop]||[],u=a.length||0;if(f(a))for(var l=0;l<u;l++)i.appendChild(t.call(r,a[l],l));else{l=0;for(var c in a)i.appendChild(t.call(r,a[c],c,l)),l++}n=i.lastChild;if(e.path){var s=u;r.$e.on(e.path,function(e,o){!function(e,o){if(e>0){for(var a=o.length,u=a-e;u<a;u++)i.appendChild(t.call(r,o[u],u));var l=i.lastChild;n.parentElement.insertBefore(i,n.nextSibling),n=l}else if(e<0)for(u=0;u<Math.abs(e);u++){var c=n.previousSibling;n.parentElement.removeChild(n),n=c}}(o.length-s,o),s=o.length})}return i};function F(e,t,n){this.path=e.__path+"."+t,this.get=(()=>e[t]),this.source=e,this.prop=t,this.parent=n}var H=0;const R=function(e,t,n){var r={s:null,a:[],t:[],f:e.toString()},i=this;if(1===n.length&&e.toString().replace(/(function \(\)\{ return |\(|\)|\; \})/g,"").trim()===n[0])return new F(t[0][0],t[0][1],function(){return i});var o=t.length;r.s=e.call(this),r.a=new Array(o),r.t=new Array(o),r.__path="$link-"+H,H+=1;for(var a=0;a<o;a++)r.a[a]=t[a][0][t[a][1]],r.t[a]="$rdi["+a+"]",r.f=r.f.replace(n[a],r.t[a]),function(e,t,n,r){i.$e.on(e,(e,o)=>{t.a[r]=o;var a=t.f.call(i,t.a);t.s!==a&&(t.s=a,i.$e.emit(n,t.s))})}(t[a][0].__path+"."+t[a][1],r,r.__path+".s",a);return r.f=new Function("$rdi","return "+r.f+"();"),o<=0?r.s:new F(r,"s",function(){return i})};function W(e,t){return new B(e,t,this)}function B(e,t,n){this.cases=[{a:e,e:t}],this.w=[],this.cache=[],this.els=D.cloneNode(),j(e)&&this.w.push(e),this.watch=function(e){for(var t in this.w)(function(t){n.$e.on(this.w[t].path,(t,n)=>{e(n)})}).call(this,t)},this.__do=function(){var e={id:null};for(var t in this.cases){if(j(this.cases[t].a)?this.cases[t].a.get():this.cases[t].a){e.id=t,e.r=this.cases[t].e;break}}return void 0===e.r&&(e.r=this.els),e}}function L(e){return e}function I(e,t,n){return t?R.call(this,e,t,n.split(",")):e}function Z(){s=!0}function q(){s=!1;for(var e=0;e<m.length;e++)"function"==typeof m[e].onMount&&m[e].onMount.call(m[e])}B.prototype.elseif=function(e,t){return this.cases.push({a:e,e:t}),j(e)&&this.w.push(e),this},B.prototype.cond=B.prototype.elseif,B.prototype.else=function(e){return this.els=e,this};const G={version:"0.1.2",activeComponents:m,r:T,l:L,cond:W,component:x,mount:M,freeze:Z,unfreeze:q};window.$Radi=G,e.version="0.1.2",e.activeComponents=m,e.text=k,e.r=T,e.component=x,e.mount=M,e.list=z,e.link=R,e.cond=W,e.l=L,e.ll=I,e.freeze=Z,e.unfreeze=q,e.use=function(e){return e(G)}});
//# sourceMappingURL=radi.js.map